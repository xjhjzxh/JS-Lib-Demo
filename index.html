<html>
  <head>
    <style>
      .external.text {
        padding: 4px;
      }
      .info {
        white-space: pre-wrap;
        margin-bottom: 16px;
        word-wrap: break-word;
        margin-top: 50px;
      }
      .conflict-row {
        display: flex;
        gap: 16px;
        align-items: center;
        border-bottom: 1px solid #ccc;
      }
      .conflict-header {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h3>附魔列表:</h3>
    <table id="enchantment-table" border="1"></table>
    <h3>不兼容附魔列表:</h3>
    <div id="conflict"></div>
    <div id="browser-info" class="info"></div>

    <script type="text/javascript" src="./file.js"></script>
    <script>
      var userAgent = navigator.userAgent;
      var screen = JSON.stringify({
        width: window.screen.width,
        height: window.screen.height,
        availWidth: window.screen.availWidth,
        availHeight: window.screen.availHeight,
        colorDepth: window.screen.colorDepth,
        pixelDepth: window.screen.pixelDepth,
        dpi: window.devicePixelRatio
      });
      document.getElementById('browser-info').innerText =
        '用户代理: ' + userAgent + '\n屏幕信息: ' + screen;

      var columns = [
        '名称',
        '命名空间ID',
        '数字ID',
        '最高等级',
        '概述',
        '适用物品',
        '相容物品',
        '权重'
      ];
      const ele = document.getElementById('enchantment-table');

      // 使用 columns 数组生成表格的表头
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      columns.forEach(column => {
        const th = document.createElement('th');
        th.textContent = column;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      ele.appendChild(thead);

      // 使用 data 数组生成表格的内容
      const tbody = document.createElement('tbody');
      data.forEach(d => {
        const row = document.createElement('tr');
        columns.forEach(column => {
          const td = document.createElement('td');
          td.innerHTML = d[column] || ''; // 如果数据中没有对应的字段，则填充空字符串
          row.appendChild(td);
        });
        tbody.appendChild(row);
      });

      ele.appendChild(tbody);

      // 在表格上方添加按钮和单选框
      const controlsDiv = document.createElement('div');
      controlsDiv.style.position = 'fixed';
      controlsDiv.style.bottom = '20px';
      controlsDiv.style.right = '20px';
      controlsDiv.style.display = 'flex';
      controlsDiv.style.flexDirection = 'column';
      controlsDiv.style.gap = '12px';
      controlsDiv.style.padding = '12px';
      controlsDiv.style.background = 'rgba(255, 255, 255, 0.92)';
      controlsDiv.style.borderRadius = '10px';
      controlsDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
      controlsDiv.style.maxWidth = 'min(90vw, 260px)';
      controlsDiv.style.zIndex = '1000';

      document.body.style.padding = '24px 16px 200px';
      document.body.style.boxSizing = 'border-box';
      ele.style.width = '100%';
      ele.style.borderCollapse = 'collapse';

      // 创建切换显示模式的按钮
      const toggleButton = document.createElement('button');
      toggleButton.textContent = '切换显示模式';
      let displayMode = 'simple'; // 默认显示模式

      toggleButton.addEventListener('click', () => {
        displayMode = displayMode === 'all' ? 'simple' : 'all';
        updateTable();
        updateConflict();
      });
      controlsDiv.appendChild(toggleButton);

      // 设置按钮样式
      const defaultButtonPadding = '10px 20px';
      const defaultButtonFontSize = '18px';
      toggleButton.style.padding = defaultButtonPadding;
      toggleButton.style.fontSize = defaultButtonFontSize;
      toggleButton.style.borderRadius = '8px';
      toggleButton.style.cursor = 'pointer';

      // 创建单选框和下拉选项
      const filterSelect = document.createElement('select');
      const options = [
        '',
        '剑',
        '斧',
        '镐',
        '锹',
        '剪刀',
        '弓',
        '钓鱼竿',
        '锄',
        '打火石',
        '胡萝卜钓竿',
        '盾牌',
        '诡异菌钓竿',
        '刷子',
        '三叉戟',
        '弩',
        '指南针',
        '追溯指针',

        '头盔',
        '海龟壳',
        '胸甲',
        '护腿',
        '靴子',
        '鞘翅',
        '南瓜',
        '生物头颅'
      ];
      options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option ?? '全部';
        filterSelect.appendChild(opt);
      });

      filterSelect.addEventListener('change', () => {
        updateTable();
        updateConflict();
      });
      controlsDiv.appendChild(filterSelect);

      const defaultSelectPadding = '10px';
      const defaultSelectFontSize = '18px';
      filterSelect.style.padding = defaultSelectPadding;
      filterSelect.style.fontSize = defaultSelectFontSize;
      filterSelect.style.borderRadius = '8px';

      function isMobileViewport() {
        return (
          /Mobi|Android|iPhone|iPad|iPod|Tablet/i.test(navigator.userAgent) ||
          window.screen.width <= 768
        );
      }

      function applyResponsiveSizing() {
        if (isMobileViewport()) {
          document.documentElement.style.fontSize = '28px';
          document.body.style.fontSize = '28px';
          toggleButton.style.padding = '14px 28px';
          toggleButton.style.fontSize = '30px';
          filterSelect.style.padding = '14px';
          filterSelect.style.fontSize = '30px';
          ele.style.fontSize = '28px';
        } else {
          document.documentElement.style.fontSize = '';
          document.body.style.fontSize = '';
          toggleButton.style.padding = defaultButtonPadding;
          toggleButton.style.fontSize = defaultButtonFontSize;
          filterSelect.style.padding = defaultSelectPadding;
          filterSelect.style.fontSize = defaultSelectFontSize;
        }
      }

      applyResponsiveSizing();
      window.addEventListener('resize', applyResponsiveSizing);

      ele.parentNode.insertBefore(controlsDiv, ele);

      // 更新表格内容的函数
      function updateTable() {
        // 清空表格内容
        ele.innerHTML = '';

        // 生成表头
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        const columnsToShow =
          displayMode === 'all'
            ? columns
            : ['名称', '命名空间ID', '数字ID', '最高等级'];
        columnsToShow.forEach(column => {
          const th = document.createElement('th');
          th.textContent = column;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        ele.appendChild(thead);

        // 生成表格内容
        const tbody = document.createElement('tbody');
        const selectedFilter = filterSelect.value;
        data.forEach(d => {
          if (
            selectedFilter &&
            !(
              (d['适用物品'] && d['适用物品'].includes(selectedFilter)) ||
              (d['相容物品'] && d['相容物品'].includes(selectedFilter))
            )
          ) {
            return; // 过滤掉不符合条件的行
          }

          const row = document.createElement('tr');
          columnsToShow.forEach(column => {
            const td = document.createElement('td');
            td.innerHTML = d[column] || ''; // 如果数据中没有对应的字段，则填充空字符串
            row.appendChild(td);
          });
          tbody.appendChild(row);
        });
        ele.appendChild(tbody);
      }

      function updateConflict() {
        const ele = document.getElementById('conflict');
        ele.innerHTML = '';
        const conflictPairs = {
          '剑': [['亡灵杀手', '节肢杀手', '锋利']],
          '斧': [
            ['时运', '精准采集'],
            ['亡灵杀手', '节肢杀手', '锋利']
          ],
          '镐,锹': [['时运', '精准采集']],
          '弓': [['无限', '经验修补']],
          '三叉戟': [
            ['引雷', '激流'],
            ['忠诚', '激流']
          ],
          '弩': [['多重射击', '穿透']],
          '头盔,海龟壳': [['保护', '火焰保护', '爆炸保护', '弹射物保护']],
          '胸甲,护腿': [['保护', '火焰保护', '爆炸保护', '弹射物保护']],
          '靴子': [
            ['保护', '火焰保护', '爆炸保护', '弹射物保护'],
            ['深海探索者', '冰霜行者']
          ]
        };
        const selectedFilter = filterSelect.value;
        Object.keys(conflictPairs).forEach(key => {
          if (selectedFilter && !key.includes(selectedFilter)) {
            return; // 过滤掉不符合条件的行
          }

          const row = document.createElement('div');
          row.className = 'conflict-row';
          const header = document.createElement('div');
          header.className = 'conflict-header';
          header.textContent = key;
          const content = document.createElement('div');
          content.className = 'conflict-content';
          row.appendChild(content);
          row.appendChild(header);
          conflictPairs[key].forEach(pair => {
            const p = document.createElement('div');
            p.textContent = pair.join(' , ');
            content.appendChild(p);
          });
          row.appendChild(content);
          ele.appendChild(row);
        });
      }

      // 初始化表格内容
      updateTable();
      updateConflict();
    </script>
  </body>
</html>
